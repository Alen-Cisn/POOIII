@page "/login"
@layout EmptyLayout

@attribute [AllowAnonymous]

@using Blazored.LocalStorage
@using Microsoft.AspNetCore.WebUtilities
@using Txt.Ui.Models
@using Txt.Ui.Services.Interfaces

@inject IHttpClientFactory HttpFactory
@inject ILocalStorageService localStorage
@inject NavigationManager NavigationManager
@inject IAuthService authService

<PageTitle>Login</PageTitle>

<h1>Login</h1>

<div class="login-container">
    <p class="status-message" role="status">Please, enter credentials</p>
    <EditForm Model="@loginRequest" OnValidSubmit="@LoginSubmit">
        <DataAnnotationsValidator />
        <div class="form-group">
            <HxInputText @bind-Value="loginRequest.Email" Label="Email address" InputMode="InputMode.Email" />
        </div>
        <div class="form-group">
            <HxInputText @bind-Value="loginRequest.Password" Label="Password" Type="InputType.Password" />
        </div>
        <HxSubmit Text="Submit" Color="ThemeColor.Primary" class="submit-button" />
    </EditForm>
</div>
@code {
    private LoginRequest loginRequest = new()
        {
            Email = "",
            Password = "",
        };

    private async Task LoginSubmit()
    {
        await authService.LoginAsync(loginRequest.Email, loginRequest.Password);
    }
}